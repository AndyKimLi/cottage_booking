# üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Prometheus + Grafana

## ‚úÖ –ß—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### üîß **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
- ‚úÖ –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ PostgreSQL, Redis, RabbitMQ
- ‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫)
- ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π

### üìà **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –î–∞—à–±–æ—Ä–¥ Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –∏ –æ—à–∏–±–∫–∏

### üìù **Loki** - —Å–±–æ—Ä –ª–æ–≥–æ–≤
- ‚úÖ –õ–æ–≥–∏ Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –õ–æ–≥–∏ Nginx
- ‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana

### üö® **AlertManager** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –ê–ª–µ—Ä—Ç—ã –≤ Telegram
- ‚úÖ Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
- ‚úÖ –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

## üöÄ –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**Linux/Mac:**
```bash
./scripts/setup_monitoring.sh
```

**Windows:**
```cmd
scripts\setup_monitoring.bat
```

### 2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker-compose up -d
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
docker-compose ps
```

## üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

| –°–µ—Ä–≤–∏—Å | URL | –õ–æ–≥–∏–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----|-------|----------|
| **Grafana** | http://localhost:3000 | admin/admin123 | –î–∞—à–±–æ—Ä–¥—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è |
| **Prometheus** | http://localhost:9090 | - | –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–ª–µ—Ä—Ç—ã |
| **AlertManager** | http://localhost:9093 | - | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ |
| **Loki** | http://localhost:3100 | - | –õ–æ–≥–∏ |

## üìä –î–∞—à–±–æ—Ä–¥—ã Grafana

### Django Application Dashboard
- **HTTP Requests Rate** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
- **HTTP Response Time** - –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (95-–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å)
- **HTTP Status Codes** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
- **Database Connections** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
- **Request Duration Over Time** - –≥—Ä–∞—Ñ–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
- –°–µ—Ç–µ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

## üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤

### 1. Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:**
1. –ù–∞–ø–∏—à–∏—Ç–µ @BotFather –≤ Telegram
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞: `/newbot`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω

**–£–∑–Ω–∞–π—Ç–µ chat_id:**
1. –ù–∞–ø–∏—à–∏—Ç–µ @userinfobot –≤ Telegram
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID

**–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```yaml
# monitoring/alertmanager.yml
receivers:
  - name: 'telegram-alerts'
    webhook_configs:
      - url: 'https://api.telegram.org/bot<YOUR_BOT_TOKEN>/sendMessage'
```

### 2. Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–û–±–Ω–æ–≤–∏—Ç–µ `monitoring/alertmanager.yml`:
```yaml
global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@yourdomain.com'
  smtp_auth_username: 'your-email@gmail.com'
  smtp_auth_password: 'your-app-password'
```

## üö® –¢–∏–ø—ã –∞–ª–µ—Ä—Ç–æ–≤

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (Critical)
- **DjangoDown** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
- **PostgreSQLDown** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- **DjangoHighErrorRate** - –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫ 5xx

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (Warning)
- **DjangoHighResponseTime** - –≤—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
- **PostgreSQLHighConnections** - –º–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
- **HighMemoryUsage** - –≤—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **HighCPUUsage** - –≤—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU

## üìà –ú–µ—Ç—Ä–∏–∫–∏ Django

### HTTP –º–µ—Ç—Ä–∏–∫–∏
- `django_http_requests_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- `django_http_request_duration_seconds` - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- `django_http_requests_by_status` - –∑–∞–ø—Ä–æ—Å—ã –ø–æ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–∞–º

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `django_db_connections_total` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- `django_db_query_duration_seconds` - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- `django_db_queries_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

### –ö—ç—à
- `django_cache_operations_total` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫—ç—à–µ–º
- `django_cache_hits_total` - –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫—ç—à
- `django_cache_misses_total` - –ø—Ä–æ–º–∞—Ö–∏ –∫—ç—à–∞

## üîç –ü–æ–∏—Å–∫ –ª–æ–≥–æ–≤

### –í Grafana
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "Explore"
3. –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ "Loki"
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ LogQL –¥–ª—è –ø–æ–∏—Å–∫–∞:

```logql
# –í—Å–µ –ª–æ–≥–∏ Django
{job="django"}

# –û—à–∏–±–∫–∏ Django
{job="django"} |= "ERROR"

# –õ–æ–≥–∏ –ø–æ —É—Ä–æ–≤–Ω—é
{job="django"} | json | level="ERROR"

# –õ–æ–≥–∏ Nginx
{job="nginx"}

# –û—à–∏–±–∫–∏ 5xx
{job="nginx"} | json | status >= 500
```

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana (http://localhost:3000)
2. –ù–∞–∂–º–∏—Ç–µ "+" ‚Üí "Dashboard"
3. –î–æ–±–∞–≤—å—Ç–µ –ø–∞–Ω–µ–ª–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –¥–∞—à–±–æ—Ä–¥

### –ò–º–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "Dashboard" ‚Üí "Import"
2. –í—Å—Ç–∞–≤—å—Ç–µ JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Prometheus –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker-compose logs prometheus

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker-compose exec prometheus cat /etc/prometheus/prometheus.yml
```

### Grafana –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Prometheus
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å Docker
docker network ls
docker network inspect cottage_default
```

### –õ–æ–≥–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Loki
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Promtail
docker-compose logs promtail

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker-compose exec promtail cat /etc/promtail/config.yml
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Prometheus Documentation](https://prometheus.io/docs/)
- [Grafana Documentation](https://grafana.com/docs/)
- [Loki Documentation](https://grafana.com/docs/loki/)
- [AlertManager Documentation](https://prometheus.io/docs/alerting/latest/alertmanager/)

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram –±–æ—Ç–∞** –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
2. **–°–æ–∑–¥–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã** –¥–ª—è –≤–∞—à–∏—Ö –Ω—É–∂–¥
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ retention –ø–æ–ª–∏—Ç–∏–∫–∏** –¥–ª—è –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫
4. **–î–æ–±–∞–≤—å—Ç–µ custom –º–µ—Ç—Ä–∏–∫–∏** –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
