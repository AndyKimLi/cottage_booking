from django.core.management.base import BaseCommand
from apps.cottages.models import Cottage, Amenity, CottageAmenity


class Command(BaseCommand):
    help = 'Заполняет базу данных коттеджами и удобствами'

    def handle(self, *args, **options):
        self.stdout.write('Начинаем заполнение базы данных...')
        
        # Создаем удобства
        amenities_data = [
            {'name': 'Wi-Fi', 'icon': 'fas fa-wifi'},
            {'name': 'Парковка', 'icon': 'fas fa-car'},
            {'name': 'Бассейн', 'icon': 'fas fa-swimming-pool'},
            {'name': 'Сауна', 'icon': 'fas fa-hot-tub'},
            {'name': 'Барбекю', 'icon': 'fas fa-fire'},
            {'name': 'Камин', 'icon': 'fas fa-fire'},
            {'name': 'Кухня', 'icon': 'fas fa-utensils'},
            {'name': 'Стиральная машина', 'icon': 'fas fa-tshirt'},
            {'name': 'Кондиционер', 'icon': 'fas fa-snowflake'},
            {'name': 'Отопление', 'icon': 'fas fa-thermometer-half'},
            {'name': 'Телевизор', 'icon': 'fas fa-tv'},
            {'name': 'Джакузи', 'icon': 'fas fa-hot-tub'},
            {'name': 'Терраса', 'icon': 'fas fa-home'},
            {'name': 'Сад', 'icon': 'fas fa-tree'},
            {'name': 'Детская площадка', 'icon': 'fas fa-child'},
            {'name': 'Велосипеды', 'icon': 'fas fa-bicycle'},
            {'name': 'Лодка', 'icon': 'fas fa-ship'},
            {'name': 'Рыбалка', 'icon': 'fas fa-fish'},
        ]
        
        # Создаем удобства
        amenities = {}
        for amenity_data in amenities_data:
            amenity, created = Amenity.objects.get_or_create(
                name=amenity_data['name'],
                defaults={'icon': amenity_data['icon']}
            )
            amenities[amenity_data['name']] = amenity
            if created:
                self.stdout.write(f'Создано удобство: {amenity.name}')
        
        # Данные коттеджей
        cottages_data = [
            {
                'name': 'Уютный домик у озера',
                'description': 'Прекрасный деревянный коттедж на берегу живописного озера. Идеально подходит для романтического отдыха или семейного отпуска. В доме есть все необходимое для комфортного проживания.',
                'address': 'Ленинградская область, Приозерский район, пос. Кузнечное, ул. Озерная, 15',
                'capacity': 4,
                'price_per_night': 3500.00,
                'amenities': ['Wi-Fi', 'Парковка', 'Камин', 'Кухня', 'Терраса', 'Рыбалка']
            },
            {
                'name': 'Лесной коттедж "Сосны"',
                'description': 'Просторный коттедж в сосновом лесу с собственной сауной и бассейном. Отличное место для активного отдыха и релаксации. Вокруг дома - густой лес с грибными местами.',
                'address': 'Карелия, Сортавальский район, пос. Рускеала, ул. Лесная, 8',
                'capacity': 6,
                'price_per_night': 5500.00,
                'amenities': ['Wi-Fi', 'Парковка', 'Бассейн', 'Сауна', 'Барбекю', 'Кухня', 'Стиральная машина', 'Терраса', 'Сад']
            },
            {
                'name': 'Семейный коттедж "Радуга"',
                'description': 'Большой семейный коттедж с детской площадкой и множеством развлечений. Идеально подходит для отдыха с детьми. Есть игровая комната и безопасная территория.',
                'address': 'Московская область, Истринский район, пос. Снегири, ул. Дачная, 42',
                'capacity': 8,
                'price_per_night': 4500.00,
                'amenities': ['Wi-Fi', 'Парковка', 'Кухня', 'Стиральная машина', 'Телевизор', 'Терраса', 'Сад', 'Детская площадка', 'Велосипеды']
            },
            {
                'name': 'Романтический домик "Два сердца"',
                'description': 'Уютный коттедж для двоих с джакузи и камином. Создан специально для романтического отдыха. Панорамные окна с видом на лес.',
                'address': 'Ленинградская область, Выборгский район, пос. Рощино, ул. Романтическая, 3',
                'capacity': 2,
                'price_per_night': 2800.00,
                'amenities': ['Wi-Fi', 'Парковка', 'Джакузи', 'Камин', 'Кухня', 'Кондиционер', 'Терраса']
            },
            {
                'name': 'Коттедж "Охотничий"',
                'description': 'Стильный коттедж в охотничьем стиле с камином и террасой. Подходит для любителей активного отдыха и охоты. Рядом - охотничьи угодья.',
                'address': 'Тверская область, Калининский район, пос. Завидово, ул. Охотничья, 12',
                'capacity': 5,
                'price_per_night': 4200.00,
                'amenities': ['Wi-Fi', 'Парковка', 'Камин', 'Барбекю', 'Кухня', 'Стиральная машина', 'Терраса', 'Сад', 'Велосипеды']
            },
            {
                'name': 'Водный коттедж "Волна"',
                'description': 'Коттедж на берегу реки с собственной лодкой и местом для рыбалки. Идеально для любителей водного отдыха и рыбалки.',
                'address': 'Новгородская область, Валдайский район, пос. Валдай, ул. Набережная, 7',
                'capacity': 4,
                'price_per_night': 3800.00,
                'amenities': ['Wi-Fi', 'Парковка', 'Кухня', 'Стиральная машина', 'Терраса', 'Лодка', 'Рыбалка']
            },
            {
                'name': 'Люкс коттедж "Премиум"',
                'description': 'Роскошный коттедж с сауной, бассейном и джакузи. Высокий уровень комфорта и сервиса. Идеально для особых случаев и корпоративного отдыха.',
                'address': 'Московская область, Одинцовский район, пос. Барвиха, ул. Премиум, 1',
                'capacity': 10,
                'price_per_night': 8500.00,
                'amenities': ['Wi-Fi', 'Парковка', 'Бассейн', 'Сауна', 'Джакузи', 'Барбекю', 'Камин', 'Кухня', 'Стиральная машина', 'Кондиционер', 'Телевизор', 'Терраса', 'Сад']
            },
            {
                'name': 'Эко-коттедж "Зеленый"',
                'description': 'Экологически чистый коттедж из натуральных материалов. Расположен в заповедной зоне. Идеально для любителей природы и здорового образа жизни.',
                'address': 'Карелия, Питкярантский район, пос. Ляскеля, ул. Эко, 5',
                'capacity': 3,
                'price_per_night': 3200.00,
                'amenities': ['Парковка', 'Камин', 'Кухня', 'Терраса', 'Сад', 'Велосипеды', 'Рыбалка']
            },
            {
                'name': 'Коттедж "Зимний"',
                'description': 'Уютный зимний коттедж с камином и отоплением. Отлично подходит для зимнего отдыха, катания на лыжах и санках. Рядом - горнолыжный склон.',
                'address': 'Московская область, Дмитровский район, пос. Сорочаны, ул. Зимняя, 9',
                'capacity': 6,
                'price_per_night': 4800.00,
                'amenities': ['Wi-Fi', 'Парковка', 'Камин', 'Кухня', 'Стиральная машина', 'Отопление', 'Телевизор', 'Терраса']
            },
            {
                'name': 'Семейный коттедж "Большая семья"',
                'description': 'Просторный коттедж для большой семьи или компании друзей. Много спальных мест, большая гостиная и кухня. Есть все для комфортного отдыха большой компании.',
                'address': 'Ленинградская область, Гатчинский район, пос. Сиверский, ул. Семейная, 25',
                'capacity': 12,
                'price_per_night': 6500.00,
                'amenities': ['Wi-Fi', 'Парковка', 'Бассейн', 'Барбекю', 'Кухня', 'Стиральная машина', 'Кондиционер', 'Телевизор', 'Терраса', 'Сад', 'Детская площадка', 'Велосипеды']
            }
        ]
        
        # Создаем коттеджи
        for cottage_data in cottages_data:
            cottage, created = Cottage.objects.get_or_create(
                name=cottage_data['name'],
                defaults={
                    'description': cottage_data['description'],
                    'address': cottage_data['address'],
                    'capacity': cottage_data['capacity'],
                    'price_per_night': cottage_data['price_per_night'],
                    'is_active': True
                }
            )
            
            if created:
                self.stdout.write(f'Создан коттедж: {cottage.name}')
                
                # Добавляем удобства к коттеджу
                for amenity_name in cottage_data['amenities']:
                    if amenity_name in amenities:
                        CottageAmenity.objects.get_or_create(
                            cottage=cottage,
                            amenity=amenities[amenity_name]
                        )
                        self.stdout.write(f'  - Добавлено удобство: {amenity_name}')
            else:
                self.stdout.write(f'Коттедж уже существует: {cottage.name}')
        
        self.stdout.write(
            self.style.SUCCESS(
                f'Заполнение завершено! Создано {Cottage.objects.count()} коттеджей и {Amenity.objects.count()} удобств.'
            )
        )
